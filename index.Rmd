---
title: "SQL"
output: html_document
---
## Filtering Rows and Colums

In SQL you can filter columns by using SELECT and rows by using WHERE.Let's look at an example using the Lahman baseball database. First we should load the Lahman package. We will also need the sqldf package.

```{r message=FALSE, warning=FALSE}
library(Lahman)
library(sqldf)
```

### example. Suppose we want to see the homerun totals for the 1927 Yankees. 
We could write:
```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE teamID='NYA'and yearID=1927"

sqldf(query)
```
# Baseball Example
## SQL

If one wants to find the specific codes of words for Batting they would use 'colnames(Batting)'. In these examples, SQL is being used. First one needs to load these packages:

```{r}
library(Lahman)
library(sqldf)
```

### Example: 
Find all instances where the Yankees have hit fourty or more homeruns.

```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting WHERE teamID='NYA' and HR>=40"

sqldf(query)
```

### Example:
Find all instances where a Yankee had more than fourty homeruns but less than sixty strikeouts.

```{r}
query<-"SELECT playerID,teamID,yearID,HR,SO FROM Batting WHERE HR>40 and SO<60"

sqldf(query)
```

### Example:
Find all instances of Phillies hitting more than thirty homeruns in the 1970s.

```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting WHERE teamID='PHI' and yearID>=1970 and yearID<=1979 and HR>30"

sqldf(query)
```

## ORDER BY

With SQL, we can also order the rows in the output.
### example:
suppose you wanted to find every instance of a player hitting more than fifty homeruns. Suppose you want to have the players with the highest homeruns at the top, you can do this the following way:

```{r}
query<-"SELECT playerID,teamID,yearID,HR FROM Batting
WHERE HR>50 ORDER BY HR DESC"
sqldf(query)
```

### Example:
Find all instance of a player striking out less than 10 times, make sure each player has at least 400 at-bats (AB)

```{r}
query<"SELECT playerID,teamID,yearID,SO,AB FROM Batting
WHERE SO<10 and AB>=400
order by SO"
sqldf(query)
```
## AGGREGATION

```{r}
query<-"SELECT playerID,HR FROM Batting 
WHERE playerID='ruthba01'"
sqldf(query)
```

###Example:
Find the career homerun totals for Babe Ruth.
```{r}
query<-"SELECT playerID,sum(HR) FROM Batting 
WHERE playerID='ruthba01'
GROUP BY playerID"
sqldf(query)
```

###Example:
find the career homerun totals for all players, but list only those with a total of 600 or mor. order by having greatest total at the top.
```{r}
query<-"SELECT playerID,sum(HR) FROM Batting 
GROUP BY playerID
HAVING sum(HR)>=600
ORDER BY sum(HR) DESC"
sqldf(query)
```

###Example:
What players have the highest average per season homerun total.
```{r}
query<-"SELECT playerID,avg (HR) FROM Batting
GROUP BY playerID
HAVING avg(HR) >30
ORDER BY avg(HR) DESC"
sqldf(query)
```


